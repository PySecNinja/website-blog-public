{% extends "base.html" %}

{% block title %}Blog | {{ site_name }}{% endblock %}

{% block content %}
<section class="section">
    <h1>Blog</h1>

    <div class="blog-filters">
        <form class="search-form" action="/blog" method="get">
            <input type="text" name="q" placeholder="Search posts..." value="{{ search_query }}" class="search-input">
            {% if current_tag %}<input type="hidden" name="tag" value="{{ current_tag }}">{% endif %}
            <button type="submit" class="btn btn-primary">Search</button>
        </form>

        {% if all_tags %}
        <div class="tag-filter">
            <span class="filter-label">Filter by tag:</span>
            <div class="tags">
                {% if current_tag %}
                <a href="/blog{% if search_query %}?q={{ search_query }}{% endif %}" class="tag tag-clear">Clear</a>
                {% endif %}
                {% for tag in all_tags %}
                <a href="/blog?tag={{ tag }}{% if search_query %}&q={{ search_query }}{% endif %}" class="tag {% if tag == current_tag %}tag-active{% endif %}">{{ tag }}</a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    {% if search_query or current_tag %}
    <p class="filter-info">
        {% if search_query %}Searching for "{{ search_query }}"{% endif %}
        {% if search_query and current_tag %} in {% endif %}
        {% if current_tag %}tag: {{ current_tag }}{% endif %}
        ({{ posts|length }} result{% if posts|length != 1 %}s{% endif %})
    </p>
    {% endif %}

    {% if posts %}
    <div class="post-list">
        {% for post in posts %}
        <article class="post-card">
            <h2><a href="/blog/{{ post.slug }}">{{ post.title }}</a></h2>
            <div class="post-meta">
                <time>{{ post.date.strftime('%B %d, %Y') }}</time>
                <span class="reading-time">{{ post.reading_time }} min read</span>
            </div>
            {% if post.description %}
            <p>{{ post.description }}</p>
            {% endif %}
            {% if post.tags %}
            <div class="tags">
                {% for tag in post.tags %}
                <a href="/blog?tag={{ tag }}" class="tag">{{ tag }}</a>
                {% endfor %}
            </div>
            {% endif %}
        </article>
        {% endfor %}
    </div>

    {% if total_pages > 1 %}
    <nav class="pagination">
        {% if has_prev %}
        <a href="/blog?page={{ page - 1 }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_tag %}&tag={{ current_tag }}{% endif %}" class="btn btn-secondary">&larr; Prev</a>
        {% endif %}
        <span class="page-info">Page {{ page }} of {{ total_pages }}</span>
        {% if has_next %}
        <a href="/blog?page={{ page + 1 }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_tag %}&tag={{ current_tag }}{% endif %}" class="btn btn-secondary">Next &rarr;</a>
        {% endif %}
    </nav>
    {% endif %}
    {% else %}
    <p>No posts found.</p>
    {% endif %}
</section>
{% endblock %}
